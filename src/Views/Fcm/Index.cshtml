@model ToolsWebsite.Models.FcmTestModel
@using ToolsWebsite.Models
@{
    ViewData["Title"] = "Push Notification Tester";
    ViewData["Description"] = "Free push notification tester by Udaiappa Ramachandran. Test FCM and OneSignal push notifications instantly. No registration required.";
}

<div class="alert alert-warning border-2 border-warning mb-4">
    <h5 class="alert-heading"><i class="fas fa-exclamation-triangle"></i> Security Disclaimer</h5>
    <p class="mb-0"><strong>We do not store any information transmitted through this page.</strong> We are not responsible for any unauthorized access or misuse of your credentials or data if compromised due to factors outside of our control. This includes, but is not limited to, phishing attempts, malware infections, or breaches of third-party services where your information may have been shared. Use only test/development credentials and never production keys or sensitive data.</p>
</div>

<div class="row">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h1><i class="fas fa-bell"></i> Push Notification Tester</h1>
                <p class="mb-0 text-muted">Test FCM &amp; OneSignal push notifications instantly &bull; Free developer tool</p>
            </div>
            <div class="card-body">
                <form asp-action="SendNotification" method="post">
                    
                    <!-- Provider selector -->
                    <div class="mb-3">
                        <label asp-for="Provider" class="form-label fw-bold"></label>
                        <select asp-for="Provider" asp-items="Html.GetEnumSelectList<NotificationProvider>()" 
                                class="form-select" id="providerSelect">
                        </select>
                    </div>
                    
                    <!-- FCM fields -->
                    <div id="fcmFields">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label asp-for="ServerKey" class="form-label"></label> <span class="text-danger">*</span>
                                    <input asp-for="ServerKey" class="form-control" placeholder="Paste Google Service Account JSON" />
                                    <span asp-validation-for="ServerKey" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label asp-for="DeviceToken" class="form-label"></label> <span class="text-danger">*</span>
                                    <input asp-for="DeviceToken" class="form-control" placeholder="Enter device registration token" />
                                    <span asp-validation-for="DeviceToken" class="text-danger"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- OneSignal fields -->
                    <div id="oneSignalFields" style="display: none;">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label asp-for="OneSignalAppId" class="form-label"></label> <span class="text-danger">*</span>
                                    <input asp-for="OneSignalAppId" class="form-control" placeholder="OneSignal App ID" />
                                    <span asp-validation-for="OneSignalAppId" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label asp-for="OneSignalApiKey" class="form-label"></label> <span class="text-danger">*</span>
                                    <input asp-for="OneSignalApiKey" class="form-control" type="password" placeholder="OneSignal REST API Key" />
                                    <span asp-validation-for="OneSignalApiKey" class="text-danger"></span>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label asp-for="OneSignalUserIds" class="form-label"></label> <span class="text-danger">*</span>
                                    <input asp-for="OneSignalUserIds" class="form-control" placeholder="user1@example.com, user2@example.com" />
                                    <span asp-validation-for="OneSignalUserIds" class="text-danger"></span>
                                    <div class="form-text">Comma-separated external user IDs (provide User IDs or Segments)</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label asp-for="OneSignalSegments" class="form-label"></label>
                                    <input asp-for="OneSignalSegments" class="form-control" placeholder="Subscribed Users, Active Users" />
                                    <span asp-validation-for="OneSignalSegments" class="text-danger"></span>
                                    <div class="form-text">Comma-separated segments (alternative to User IDs)</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <hr />
                    
                    <!-- Shared fields -->
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label asp-for="Title" class="form-label"></label> <span class="text-danger">*</span>
                                <input asp-for="Title" class="form-control" placeholder="Notification title" />
                                <span asp-validation-for="Title" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label asp-for="Body" class="form-label"></label> <span class="text-danger">*</span>
                                <input asp-for="Body" class="form-control" placeholder="Notification body message" />
                                <span asp-validation-for="Body" class="text-danger"></span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label asp-for="ImageUrl" class="form-label"></label>
                        <input asp-for="ImageUrl" class="form-control" placeholder="https://example.com/image.jpg (optional)" />
                        <span asp-validation-for="ImageUrl" class="text-danger"></span>
                    </div>
                    
                    <div class="mb-3">
                        <label asp-for="Data" class="form-label"></label>
                        <textarea asp-for="Data" class="form-control" rows="3" placeholder='{"click_action":"https://udai.io/"} (optional)'></textarea>
                        <span asp-validation-for="Data" class="text-danger"></span>
                        <div class="form-text">Optional JSON data to send with the notification</div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary" id="sendBtn">
                        <i class="fas fa-paper-plane"></i> Send Notification
                    </button>
                </form>
            </div>
        </div>
    </div>
    
    <div class="col-md-4">
        <!-- FCM help -->
        <div class="card" id="fcmHelp">
            <div class="card-header">
                <h5><i class="fas fa-info-circle"></i> FCM Setup</h5>
            </div>
            <div class="card-body">
                <ol>
                    <li><strong>Service Account JSON:</strong> Firebase Console &rarr; Project Settings &rarr; Service accounts &rarr; Generate new private key</li>
                    <li><strong>Device Token:</strong> Registration token from your app/device</li>
                    <li><strong>Title &amp; Body:</strong> Notification content</li>
                    <li><strong>Image URL:</strong> Optional image in notification</li>
                    <li><strong>Data (JSON):</strong> Include <code>click_action</code> for URL on tap</li>
                </ol>
                <div class="alert alert-info mb-0">
                    <small><i class="fas fa-lightbulb"></i> <strong>Tip:</strong> Uses FCM HTTP v1 API with OAuth2.</small>
                </div>
            </div>
        </div>
        
        <!-- OneSignal help -->
        <div class="card" id="oneSignalHelp" style="display: none;">
            <div class="card-header">
                <h5><i class="fas fa-info-circle"></i> OneSignal Setup</h5>
            </div>
            <div class="card-body">
                <ol>
                    <li><strong>App ID:</strong> OneSignal Dashboard &rarr; Settings &rarr; Keys &amp; IDs</li>
                    <li><strong>REST API Key:</strong> Same page, under REST API Key</li>
                    <li><strong>User IDs:</strong> External user IDs set via <code>setExternalUserId()</code></li>
                    <li><strong>Segments:</strong> Target groups (e.g. "Subscribed Users")</li>
                    <li><strong>Image:</strong> Supports Android big picture &amp; iOS attachments</li>
                </ol>
                <div class="alert alert-info mb-0">
                    <small><i class="fas fa-lightbulb"></i> <strong>Tip:</strong> Provide User IDs for targeted push, or Segments for broad push.</small>
                </div>
            </div>
        </div>
    </div>
</div>

@if (!string.IsNullOrEmpty(Model.Result))
{
    <div class="row mt-4">
        <div class="col-12">
            <div class="alert @(Model.IsSuccess ? "alert-success" : "alert-danger")">
                <h5><i class="fas fa-@(Model.IsSuccess ? "check-circle" : "times-circle")"></i> Notification Result</h5>
                <pre class="mb-0" style="white-space: pre-wrap;">@Model.Result</pre>
            </div>
        </div>
    </div>
}

<div class="row mt-4">
    <div class="col-12">
        <div class="card border-info">
            <div class="card-header">
                <h6><i class="fas fa-question-circle"></i> About This Push Notification Testing Tool</h6>
            </div>
            <div class="card-body">
                <p>This free push notification tester helps developers quickly test notifications across multiple providers without writing code.</p>
                <div class="row">
                    <div class="col-md-4">
                        <h6>Supported Providers:</h6>
                        <ul class="list-unstyled">
                            <li>&bull; Firebase Cloud Messaging (FCM)</li>
                            <li>&bull; OneSignal</li>
                        </ul>
                    </div>
                    <div class="col-md-4">
                        <h6>Perfect for:</h6>
                        <ul class="list-unstyled">
                            <li>&bull; Testing mobile app push notifications</li>
                            <li>&bull; Verifying notification delivery</li>
                            <li>&bull; Testing content and formatting</li>
                            <li>&bull; Debugging push notification issues</li>
                        </ul>
                    </div>
                    <div class="col-md-4">
                        <h6>Features:</h6>
                        <ul class="list-unstyled">
                            <li>&bull; No data storage - completely secure</li>
                            <li>&bull; Supports images &amp; custom data</li>
                            <li>&bull; Android &amp; iOS support</li>
                            <li>&bull; Free to use - no registration</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var select = document.getElementById('providerSelect');
            toggleProvider(select.value);
            select.addEventListener('change', function () {
                toggleProvider(this.value);
            });

            // Client-side validation before submit
            document.querySelector('form').addEventListener('submit', function (e) {
                var provider = document.getElementById('providerSelect').value;
                var errors = [];

                if (provider === '@((int)NotificationProvider.OneSignal)' || provider === 'OneSignal') {
                    if (!document.getElementById('OneSignalAppId').value.trim())
                        errors.push('App ID is required for OneSignal.');
                    if (!document.getElementById('OneSignalApiKey').value.trim())
                        errors.push('REST API Key is required for OneSignal.');
                    if (!document.getElementById('OneSignalUserIds').value.trim() && !document.getElementById('OneSignalSegments').value.trim())
                        errors.push('Provide either User IDs or Segments.');
                } else {
                    if (!document.getElementById('ServerKey').value.trim())
                        errors.push('Service Account JSON is required for FCM.');
                    if (!document.getElementById('DeviceToken').value.trim())
                        errors.push('Device Token is required for FCM.');
                }

                if (errors.length > 0) {
                    e.preventDefault();
                    alert(errors.join('\n'));
                }
            });
        });

        function toggleProvider(value) {
            var isFcm = value === '@((int)NotificationProvider.Fcm)' || value === 'Fcm';
            var isOneSignal = value === '@((int)NotificationProvider.OneSignal)' || value === 'OneSignal';

            document.getElementById('fcmFields').style.display = isFcm ? '' : 'none';
            document.getElementById('fcmHelp').style.display = isFcm ? '' : 'none';
            document.getElementById('oneSignalFields').style.display = isOneSignal ? '' : 'none';
            document.getElementById('oneSignalHelp').style.display = isOneSignal ? '' : 'none';
        }
    </script>
}